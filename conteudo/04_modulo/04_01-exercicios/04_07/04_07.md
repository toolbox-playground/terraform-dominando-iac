# 04_07 - Exerc√≠cio Detectando Recursos √ìrf√£os no Terraform

## Objetivo

Ensinar como detectar e gerenciar recursos √≥rf√£os ‚Äî recursos que foram criados pelo Terraform, mas que depois foram removidos do c√≥digo sem serem destru√≠dos.

### Cen√°rio

Imagine que voc√™ tem uma infraestrutura Terraform que cria:  
- Uma VPC  
- Uma m√°quina virtual (EC2)  
- Um bucket S3  

Por√©m, um erro acontece: o bucket S3 √© removido do c√≥digo, mas n√£o foi destru√≠do via Terraform. Isso cria um recurso √≥rf√£o no provedor de nuvem.  

Neste exerc√≠cio, voc√™ ir√° detectar e corrigir esse problema.

#### Passo 1: Criando a Infraestrutura
Execute o arquivo **main.tf** presente nesse diret√≥rio:
```bash
terraform init
terraform apply -auto-approve
```

#### Passo 2: Criando um Recurso √ìrf√£o
Agora vamos simular um recurso √≥rf√£o removendo o bucket S3 do c√≥digo.  

##### 1. Edite o arquivo main.tf e remova completamente esta parte
```yaml
resource "aws_s3_bucket" "my_bucket" {
  bucket = "my-terraform-bucket-123456789"

  tags = {
    Name = "MyBucket"
  }
}

output "s3_bucket_name" {
  value = aws_s3_bucket.my_bucket.id
}
```

##### 2. Execute terraform plan para detectar diferen√ßas

#### Passo 3: Detectando Recursos √ìrf√£os

Para verificar se h√° recursos √≥rf√£os, siga estas etapas:  

1. Verificando o estado do Terraform  

Execute o seguinte comando para listar todos os recursos ainda gerenciados pelo Terraform:  
```bash
terraform state list
```

Voc√™ ver√° algo assim:  
```yaml
aws_vpc.main
aws_instance.web
```

O bucket S3 n√£o aparecer√°, pois foi removido do c√≥digo.  

2. Verificando manualmente na AWS  

Agora, verifique se o recurso ainda existe na AWS:  
```bash
aws s3 ls
```

Se o bucket S3 ainda estiver l√°, significa que ele se tornou um recurso √≥rf√£o.  

#### Passo 4: Corrigindo Recursos √ìrf√£os

Agora que sabemos que o bucket S3 est√° √≥rf√£o, temos tr√™s op√ß√µes para corrigi-lo:  

1. Reimportar o recurso para o Terraform

Se voc√™ quiser continuar gerenciando o bucket com Terraform, reimporte-o com:
```bash
terraform import aws_s3_bucket.my_bucket my-terraform-bucket-123456789
```

Depois, adicione o c√≥digo do bucket de volta no main.tf.

2. Destruir manualmente o recurso

Se o recurso n√£o for mais necess√°rio, exclua-o manualmente via AWS CLI:
```bash
aws s3 rb s3://my-terraform-bucket-123456789 --force
```

Ou, se for outro tipo de recurso, utilize a interface da AWS.  

3. Usar terraform destroy (se for seguro)  

Se desejar destruir toda a infraestrutura, execute:  

```bash
terraform destroy -auto-approve
```

# üìå Conclus√£o

O que voc√™ aprendeu?  
- Como um recurso pode se tornar √≥rf√£o no Terraform.  
- Como identificar recursos √≥rf√£os com terraform state list.  
- Como resolver o problema reimportando o recurso ou removendo-o manualmente.  

# üìå Desafio Extra
1.	Crie um recurso √≥rf√£o de outro tipo, como um banco de dados RDS, e tente detect√°-lo.  
2.	Use terraform state rm <recurso> para remover um recurso do estado sem destru√≠-lo. O que acontece depois?  
